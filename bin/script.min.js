!function(a,b){function c(a){"function"==typeof a&&j.dom_load_event_listeners.push(a)}function d(a){for(var b=[],c=0;c<a.childNodes.length;c++)if(b.push(a.childNodes[c]),a.childNodes[c].childNodes)for(var e=d(a.childNodes[c]),f=0;f<e.length;f++)b.push(e[f]);return b}function e(a,b,c){return"CLICK"===b?j.onTap(a,c):"undefined"!=typeof a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent(b,c),a}function f(a,b){if(this!==h)var c=f.create(a,b);else var c=f.select(a,b);return c.add=c.appendChild,c.childs=c.childNodes,c.parent=c.parentNode,c.clone=c.cloneNode,c.on=function(a){return function(b,c){e(a,b,c)}}(c),c.inner=function(a){var b=i.createElement("div");return b.setAttribute("tag-name","_inner_"),a.appendChild(b),a},c}function g(a){this.name=a,j.components[a]=this}var h=a,i=b,j={name:"MarmWork"};j.dom_load_event_listeners=[],j.dom_content_loaded=!1,j.on_dom_content_loaded=function(){if(!j.dom_content_loaded){j.dom_content_loaded=!0;for(var a=0;a<j.dom_load_event_listeners.length;a++){var b=j.dom_load_event_listeners[a];"function"==typeof b&&b()}}},e(i,"DOMContentLoaded",j.on_dom_content_loaded),e(h,"load",j.on_dom_content_loaded),h.onload=function(){j.on_dom_content_loaded()};var k=function(a){return k.get(a)};k.normalize=function(a){return a?"string"==typeof a?{url:a}:a:null},k.json=function(a){return(a=k.normalize(a))?(a.json=!0,new k.request(a)):void 0},k.get=function(a){return new k.request(a)},k.post=function(a){return(a=k.normalize(a))?(a.method="POST",new k.request(a)):void 0},k.put=function(a){return(a=k.normalize(a))?(a.method="PUT",new k.request(a)):void 0},k.delete=function(a){return(a=k.normalize(a))?(a.method="DELETE",new k.request(a)):void 0},k.request=function(a){if(!a)return!1;if("string"==typeof a&&(a={url:a}),"POST"===a.method||"PUT"===a.method||"DELETE"===a.method){var b="?";for(var c in a.options)b+=a.options.hasOwnProperty(c)?"&"+c+"="+a.options[c]:""}else{a.method="GET",a.url+=a.url.indexOf("?")<0?"?":"";for(var c in a.options)a.url+=a.options.hasOwnProperty(c)?"&"+c+"="+a.options[c]:""}this.xhr=h.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),this.xhr.options=a,this.xhr.callbacks={then:[],error:[]},this.then=function(a){return this.xhr.callbacks.then.push(a),this},this.error=function(a){return this.xhr.callbacks.error.push(a),this},this.xhr.call=function(a,b){for(var c=0;c<this.callbacks[a].length;c++)"function"==typeof this.callbacks[a][c]&&this.callbacks[a][c](b)},this.xhr.onreadystatechange=function(){if(4===this.readyState&&200==this.status){var a=this.responseText;if(this.options.json)try{a=JSON.parse(a)}catch(b){return this.call("error","invalid json"),!1}this.call("then",a)}else 4===this.readyState&&404==this.status?this.call("error","404"):4===this.readyState&&this.call("error","unknow")},this.xhr.open(a.method,a.url,!0),this.xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded"),this.xhr.send("undefined"!=typeof b?b:null)},j.onTapEventsList=[],j.onTap=function(a,b){var c=new j.onTapObject(a,b);j.onTapEventsList.push(c)},j.onTapObject=function(a,b){this.callback=b,this.element=a,this.touchstart=function(a){return function(b){a.moved=!1,a.startX=b.touches[0].clientX,a.startY=b.touches[0].clientY}}(this),this.touchmove=function(a){return function(b){(Math.abs(b.touches[0].clientX-a.startX)>10||Math.abs(b.touches[0].clientY-a.startY)>10)&&(a.moved=!0)}}(this),this.touchend=function(a){return function(b){a.moved||a.callback(b)}}(this),e(this.element,"touchstart",this.touchstart),e(this.element,"touchmove",this.touchmove),e(this.element,"touchend",this.touchend),e(this.element,"touchcancel",this.touchend),e(this.element,"click",function(a){return function(b){"ontouchstart"in h||a.callback(b)}}(this))},j.Element=f;var l=f;f.create=function(a,b){var c,d=/\w+/.exec(a)[0];if(j.components[d]){var e="object"==typeof b?b:{},f=j.components[d].create(e);child.parentNode.insertBefore(f,child),child.parentNode.removeChild(child)}else c=i.createElement(d);var g=/([a-z-_]+)(\.([a-z-_]+))/i.exec(a);g&&(c.className=g[3]);var h=/([a-z-_]+)(#([a-z-_]+))/i.exec(a);return h&&(c.id=h[3]),c},f.select=function(a){var b;return"string"!=typeof a?b=a:"#"==a[0]&&(b=i.getElementById(a.substring(1))||new l("div")),b},j.components={};j.Component=g,g.attributes_parser=function(a,b){for(var c={},d=0;d<a.length;d++)if(c[a[d].name]=a[d].value,"string"==typeof a[d].value&&"$"==a[d].value[0]&&b)for(parameter in b)a[d].value==="${"+parameter+"}"&&b.hasOwnProperty(parameter)&&(c[a[d].name]=b[parameter]);return c},g.prototype.create=function(a){var b=f(i.createDocumentFragment());this.render(b,a);var c=i.createElement("div");c.appendChild(b);var e=d(c);if(a._CHILDNODES_.length){for(var g=!1,h=0;h<e.length;h++){var j=e[h];if("_inner_"===j.getAttribute("tag-name")){for(var h=0;h<a._CHILDNODES_.length;h++)j.parentNode.insertBefore(a._CHILDNODES_[h],j);j.parentNode.removeChild(j),g=!0;break}}if(!g){console.error("L'intérieur du Component \""+this.name+"\" n'est pas défini.");for(var h=0;h<a._CHILDNODES_.length;h++)c.firstChild.appendChild(a._CHILDNODES_[h])}}for(var k=i.createDocumentFragment();c.childNodes.length;)k.appendChild(c.childNodes[0]);return k};var m=g.generate=g.gen=function(a,b){if("string"!=typeof a)return i.createElement("div");a=a.replace(/^\s+|\s+$/g,""),a=a.replace(/<(\w+?)( (.+?))?>/g,'<div tag-name="$1"$2>').replace(/<\/(.+?)>/g,"</div>");var c=i.createElement("div");c.innerHTML=a;for(var e=!1,f=0;!e;){f++,f>1024&&(console.error("Une boucle de création de component a été détéctée"),e=!0);for(var h=d(c),k=0;k<h.length;k++){var l=h[k],m=l.getAttribute("tag-name")||l.nodeName.replace("/","").toLowerCase();if(j.components[m]){var n=g.attributes_parser(l.attributes,b);n._CHILDNODES_=l.childNodes;var o=j.components[m].create(n),p=o.firstChild;for(attribute in n)n.hasOwnProperty(attribute)&&null===p.getAttribute(attribute)&&"string"==typeof n[attribute]&&p.setAttribute(attribute,n[attribute]);l.parentNode.insertBefore(o,l),l.parentNode.removeChild(l);break}}e=!0}for(var q=i.createDocumentFragment();c.childNodes.length;)q.appendChild(c.childNodes[0]);return q};g.inner=function(a){var b=i.createElement("div");return b.setAttribute("tag-name","_inner_"),a.appendChild(b),a};var n=new g("btn");n.render=function(a,b){var c=a.add(new f("button.btn"));a.inner(c),b.click&&e(c,"CLICK",b.click)},c(function(){l(i.body).add(m('<btn id="yolo">yolo</btn>')),l("#yolo").on("CLICK",function(){console.log("test")})}),h.Application=j}(window,document);